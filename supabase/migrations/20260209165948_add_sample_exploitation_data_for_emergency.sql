/*
  # Add Sample Exploitation Data for Emergency Module

  1. Purpose
    - Insert sample exploitation daily data to display in Emergency Management module
    - Provides values for: water level, inflow, and rainfall
    - Data for the last 3 days to calculate 24h rainfall

  2. Data Inserted
    - Daily exploitation records for each dam
    - Realistic values for demonstration purposes
*/

DO $$
DECLARE
  dam_record RECORD;
  current_date_val DATE;
BEGIN
  FOR dam_record IN SELECT id FROM dams LIMIT 8 LOOP
    FOR i IN 0..2 LOOP
      current_date_val := CURRENT_DATE - i;
      
      INSERT INTO exploitation_daily_data (
        dam_id,
        date,
        water_level,
        stored_volume,
        inflow_total,
        outflow_total,
        rainfall,
        registered_by
      )
      SELECT
        dam_record.id,
        current_date_val,
        CASE 
          WHEN i = 0 THEN 425.50 + (RANDOM() * 5)
          WHEN i = 1 THEN 425.20 + (RANDOM() * 5)
          ELSE 424.80 + (RANDOM() * 5)
        END,
        150000 + (RANDOM() * 10000),
        CASE 
          WHEN i = 0 THEN 15.5 + (RANDOM() * 10)
          WHEN i = 1 THEN 12.3 + (RANDOM() * 8)
          ELSE 10.8 + (RANDOM() * 6)
        END,
        8.5 + (RANDOM() * 5),
        CASE 
          WHEN i = 0 THEN 5.2 + (RANDOM() * 15)
          WHEN i = 1 THEN 8.7 + (RANDOM() * 20)
          ELSE 12.3 + (RANDOM() * 25)
        END,
        (SELECT id FROM user_profiles WHERE role = 'operator' LIMIT 1)
      WHERE NOT EXISTS (
        SELECT 1 FROM exploitation_daily_data 
        WHERE dam_id = dam_record.id AND date = current_date_val
      );
    END LOOP;
  END LOOP;
END $$;